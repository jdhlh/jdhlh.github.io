<!DOCTYPE html>
<html>
<head>
    <title>Aippt Iframe SDK</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
</head>
<body>
    <!-- 加载 SDK -->
    <script src="https://api-static.aippt.cn/aippt-iframe-sdk.js"></script>
    <script>
        // 你的 JavaScript 代码
        window.onload = function() {
            const apiSecret = '2YdWhPr6WYyWkPgZYQSuEILduOe4MvyI'; // Replace with your actual API secret
            const apiKey = '6684d4c711462'; // Replace with your actual API key
            const currentSeconds = Math.floor(Date.now() / 1000);
            const body = 'GET@/api/grant/code/@' + currentSeconds;

            // Generate HMAC-SHA1 signature
            const hash = CryptoJS.HmacSHA1(body, apiSecret);
            const base64Encoded = CryptoJS.enc.Base64.stringify(hash);

            // Construct headers
            const headers = {
                'x-api-key': apiKey,
                'x-timestamp': currentSeconds,
                'x-signature': base64Encoded
            };

            // Send request
            fetch('https://co.aippt.cn/api/grant/code?uid=1&channel=', {
                method: 'GET',
                headers: headers
            })
            .then(response => response.json())
            .then(data => {
                const m_code = data.data.code;
                // 确保 SDK 加载完成后再执行代码
                if (typeof AipptIframe !== 'undefined') {
                    console.log('AipptIframe SDK is loaded');
                    // 初始化 SDK 或调用 SDK 提供的方法
                    AipptIframe.show({
                    appkey: '6684d4c711462',
                    channel: '',
                    code: m_code,
                    options: {
                    // download_mode: 0 // 只发送消息通知，但不会进行自动下载，包含可下载地址
                    // download_mode: 1 // 直接进行下载，但是不会发送消息通知
                    download_mode: 2  // 直接进行下载，并且发送消息通知，包含可下载地址
                    },
                    onMessage(eventType,data){
                    console.log(eventType,data)
                   }
                   })
               } else {
                console.error('AipptIframe SDK is not loaded');
               }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        };
      
    </script>
</body>
</html>
